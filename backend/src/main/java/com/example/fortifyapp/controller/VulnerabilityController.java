package com.example.fortifyapp.controller;

import com.example.fortifyapp.entity.Vulnerability;
import com.example.fortifyapp.repository.VulnerabilityRepository;
import org.springframework.data.jpa.domain.Specification;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

import java.util.List;

@RestController
@RequestMapping("/api/vulnerabilities")
public class VulnerabilityController {
    private final VulnerabilityRepository repository;

    public VulnerabilityController(VulnerabilityRepository repository) {
        this.repository = repository;
    }

    @GetMapping
    public List<Vulnerability> list(@RequestParam(required = false) String severity,
                                    @RequestParam(required = false) String cweId) {
        Specification<Vulnerability> spec = Specification.where(null);
        if (severity != null) {
            spec = spec.and((root, query, cb) -> cb.equal(root.get("severity"), severity));
        }
        if (cweId != null) {
            spec = spec.and((root, query, cb) -> cb.equal(root.get("cweId"), cweId));
        }
        return repository.findAll(spec);
    }
}
